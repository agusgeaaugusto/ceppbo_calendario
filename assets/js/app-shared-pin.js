import { firebaseConfig } from './firebase-config.js';
const grid=document.getElementById('grid'); const mesActualEl=document.getElementById('mesActual');
const btnPrev=document.getElementById('prevMes'); const btnNext=document.getElementById('nextMes'); const btnHoy=document.getElementById('btnHoy');
const dot=document.getElementById('dot'); const statustext=document.getElementById('statustext');
let state={year:new Date().getFullYear(),month:new Date().getMonth(),events:{},canEdit:false,editing:null};
function renderCalendar(){const d=new Date(state.year,state.month,1);const y=d.getFullYear(),m=d.getMonth();mesActualEl.textContent=['Ene','Feb','Mar','Abr','May','Jun','Jul','Ago','Sep','Oct','Nov','Dic'][m]+' '+y;const first=new Date(y,m,1);const off=(first.getDay()+6)%7;const last=new Date(y,m+1,0).getDate();const prevLast=new Date(y,m,0).getDate();grid.innerHTML='';for(let i=0;i<42;i++){const cell=document.createElement('div');cell.className='cell';const num=document.createElement('div');num.className='num';let dn,dt;if(i<off){dn=prevLast-off+i+1;dt=new Date(y,m-1,dn)}else if(i>=off+last){dn=i-(off+last)+1;dt=new Date(y,m+1,dn)}else{dn=i-off+1;dt=new Date(y,m,dn)}num.textContent=dn;cell.appendChild(num);grid.appendChild(cell);}}
btnPrev.addEventListener('click',()=>{let m=state.month-1,y=state.year;if(m<0){m=11;y--}state.month=m;state.year=y;renderCalendar()});btnNext.addEventListener('click',()=>{let m=state.month+1,y=state.year;if(m>11){m=0;y++}state.month=m;state.year=y;renderCalendar()});btnHoy.addEventListener('click',()=>{const n=new Date();state.year=n.getFullYear();state.month=n.getMonth();renderCalendar()});renderCalendar();
(async()=>{try{const {initializeApp}=await import('https://www.gstatic.com/firebasejs/10.12.3/firebase-app.js');const {getFirestore,doc,setDoc,getDoc,onSnapshot}=await import('https://www.gstatic.com/firebasejs/10.12.3/firebase-firestore.js');const {getAuth,signInAnonymously,onAuthStateChanged}=await import('https://www.gstatic.com/firebasejs/10.12.3/firebase-auth.js');const app=initializeApp(firebaseConfig);const db=getFirestore(app);const auth=getAuth(app);const ref=doc(db,'calendars','ceppbo');onAuthStateChanged(auth,(u)=>{if(u){dot.classList.add('online');statustext.textContent='Conectado'}else{dot.classList.remove('online');statustext.textContent='Desconectado'}});await signInAnonymously(auth);const snap=await getDoc(ref);if(!snap.exists()) await setDoc(ref,{events:{}}); else state.events=snap.data().events||{};onSnapshot(ref,(s)=>{state.events=s.data().events||{};});}catch(e){console.error(e);statustext.textContent='Error Firebase';}})();